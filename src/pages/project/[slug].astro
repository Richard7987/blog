---
import client from "../../../tina/__generated__/client";
import BaseHead from "../../components/BaseHead.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import ColorScript from "../../components/ColorScript.astro";
import Tags from "../../components/Tags.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../../config";

export async function getStaticPaths() {
	try {
		const res = await client.queries.proyectosConnection();
		const proyectos = res.data.proyectosConnection.edges.map((edge) => edge.node);

		return proyectos.map((project) => ({
			params: { slug: project._sys.filename },
			props: {
				title: project.title || "Untitled Project",
				description: project.description || "",
				added: project.added,
				updated: project.updated,
				tags: project.tags || [],
				slug: project._sys.filename,
				body: project.body || ""
			}
		}));
	} catch (error) {
		console.error("Error in getStaticPaths:", error);
		return [];
	}
}

const { title, description, added, updated, tags, slug, body } = Astro.props;

// Formatear fechas
let formattedAdded = "";
let formattedUpdated = "";

if (added) {
	formattedAdded = new Date(added).toLocaleDateString("en-us", {
		year: "numeric",
		month: "short",
		day: "numeric",
	});
}

if (updated) {
	formattedUpdated = new Date(updated).toLocaleDateString("en-us", {
		year: "numeric",
		month: "short",
		day: "numeric",
	});
}
---

<!doctype html>
<html lang="en-us">
	<BaseHead title={`${title} - ${SITE_TITLE}`} description={description} />
	<body>
		<Header />
		<main>
			<article>
				<h1 class="article-title">{title}</h1>
				{formattedUpdated ?
					<span><time>{formattedAdded}</time>, last updated on <time>{formattedUpdated}</time></span>
					:
					<span>{formattedAdded && <time>{formattedAdded}</time>}</span>
				}
				<Tags tags={tags} />
				<hr />
				<div class="blog-post">
					{body ? 
						<Fragment set:html={body} /> 
						: 
						<p>{description}</p>
					}
				</div>
			</article>
		</main>
		<Footer />
		<ColorScript />
	</body>
</html>
